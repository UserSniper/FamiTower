// Include defines for various pieces of the NES hardware
#include "include.h"

//
// Global Variables (zeropage) 
// Small, frequently-used variables should go in this space. There are only around 250 bytes to go around, so choose wisely!
//
#pragma bss-name(push, "ZEROPAGE")
    unsigned char i;
    unsigned char pad1;
    unsigned char collision;
#pragma bss-name(pop)

//
// Normal Variables
// You can define larger, less frequently accessed variables here. You have about 1.5k to work with.
//
// EXAMPLE: 
// unsigned char myBigBufferArray[32];
unsigned char testVariable;




//
// Constant variables
// Anything with const in front of it will go into write-only prg instead of the very limited ram we have.
//
const unsigned char welcomeMessage[] = "Make something unique!";




//
// The fucking nametable
// screw you, ld65. here's the nametable.
const unsigned char balling[299]={
    0x03,0x01,0x03,0x89,0x00,0xd0,0xe9,0xf3,0xf3,0x00,0xd4,0xef,0xf7,0xe5,0xf2,0x00,
    0x01,0x03,0x13,0x00,0x03,0x0b,0x01,0x03,0xfe,0x01,0x03,0xdf,0x07,0x00,0x05,0x00,
    0x05,0x00,0x05,0x08,0x01,0x03,0x16,0x07,0x17,0x02,0x00,0x02,0x00,0x02,0x00,0x18,
    0x08,0x01,0x03,0x09,0x04,0x05,0x00,0x06,0x01,0x03,0x06,0x07,0x17,0x02,0x00,0x02,
    0x00,0x02,0x00,0x02,0x00,0x18,0x08,0x01,0x03,0x08,0x14,0x00,0x02,0x00,0x01,0x03,
    0x05,0x07,0x17,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x18,0x08,0x04,
    0x05,0x00,0x05,0x00,0x05,0x00,0x05,0x00,0x02,0x00,0x02,0x00,0x05,0x00,0x05,0x00,
    0x05,0x17,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x14,
    0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,
    0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x00,
    0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,
    0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x14,
    0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,
    0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x00,
    0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,
    0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x14,
    0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,
    0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x03,
    0x0a,0x04,0x05,0x05,0x01,0x00,0x03,0x30,0x00,0x03,0x00
};



// Color palette for the screen to use
const unsigned char palette[32]={ 
    0x0f,0x03,0x13,0x24,0x0f,0x00,0x10,0x30,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,
    0x0f,0x0f,0x37,0x30,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f
};












//Write the funny Italian man here
const unsigned char Peppino_Idle[]={

    -10,-24,0x05,0,
    - 2,-24,0x07,0,
      6,-24,0x09,0,
    -21,- 8,0x0b,0,

    -13,- 8,0x0d,0,
    - 5,- 8,0x0f,0,
      3,- 8,0x11,0,
     11,- 8,0x13,0,

    -21,  8,0x15,0,
    -13,  8,0x17,0,
    - 5,  8,0x19,0,
      3,  8,0x1b,0,

     11,  8,0x1d,0,
    -16, 24,0x1f,0,
    - 8, 24,0x21,0,
      0, 24,0x23,0,
    
      8, 24,0x25,0,
    0x80
};























void draw_sprites(void);


//
// Main entrypoint
// This is where your game will start running. It should essentially be an endless loop in most
// cases. The name "main" tells the runtime to run this. You can add more methods in this file
// or others and call them as your game expands. 
// 
void main(void) {
    // Turn off the screen
    ppu_off();


    // Get Controller 1
    pad1 = pad_poll(0);


    // Set the address of the ppu to $3f00 to set the background palette
    vram_adr(0x3f00);



    // Write the background palette, byte-by-byte.
    for (i = 0; i != 32; ++i) {
        vram_put(palette[i]);
    }



    // Write the address $2064 to the ppu, where we can start drawing text on the screen
    vram_adr(0x2064);

    i = 0;
    //while (welcomeMessage[i]) {
        // Add 0x60 to the ascii value of each character, to get it to line up with where the ascii table is in our chr file
        //vram_put(welcomeMessage[i] + 0x80);
        //++i;
    //}




    


    // Set the scroll to 0,0
    scroll(0, 0);

    vram_adr(0x2000);
    vram_unrle(balling);

    draw_sprites();

    // Turn the screen back on
    ppu_on_all();



    // Update variable used in unit tests
    testVariable = 1;



    // Play the first song built into the rom. By default it is the title song from Shiru's game, Lan Master
    music_play(0);



    // Infinite loop to end things
    while (1) {
        ppu_wait_nmi();
        
        if (pad1 & PAD_A) { // If the user is pressing A, make a sound!
            // Play sound effect 0 on channel 0 (second argument can be 0-3, lower is higher priority)
            sfx_play(0, 0);
        }


        
        
    }
}






void draw_sprites(void){
    //Draw Peppino
    oam_clear();
    oam_size(1);
    bank_spr(1);

    oam_meta_spr(0x7F,0x97,0x04,Peppino_Idle);


}









































